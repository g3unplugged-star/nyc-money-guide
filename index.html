<script>
  // ===== URL SLUG GENERATOR =====
  function generateSlug(title) {
    return title
      .toLowerCase()
      .replace(/[^\w\s-]/g, '') // Remove special characters
      .replace(/\s+/g, '-') // Replace spaces with hyphens
      .replace(/--+/g, '-') // Replace multiple hyphens with single hyphen
      .replace(/^-+/, '') // Trim hyphens from start
      .replace(/-+$/, ''); // Trim hyphens from end
  }

  // ===== BLOG POSTS DATA =====
  const blogPosts = [
    {
      id: 1,
      title: "NYC Rent Affordability: The 40x Rule Explained (2026 Update)",
      slug: "nyc-rent-affordability-40x-rule-explained-2026",
      excerpt: "Complete guide to NYC's rent affordability rules, including the 40x salary requirement, guarantor options, and borough-specific exceptions.",
      category: "rent",
      readTime: "12 min",
      date: "Mar 15, 2026",
      tags: ["rent", "housing", "nyc rules"],
      trending: true,
      recent: true
    },
    {
      id: 2,
      title: "How to Build Credit from Scratch in NYC (Even Without Rent History)",
      slug: "build-credit-from-scratch-nyc-no-rent-history",
      excerpt: "Step-by-step guide to building credit in New York City using secured cards, rent reporting services, and alternative credit data.",
      category: "credit",
      readTime: "10 min",
      date: "Mar 12, 2026",
      tags: ["credit", "debt", "financial health"],
      trending: true,
      recent: true
    },
    {
      id: 3,
      title: "Complete NYC Budget Breakdown: Where Does Your Money Actually Go?",
      slug: "complete-nyc-budget-breakdown-where-money-goes",
      excerpt: "Real-world budget analysis for single professionals, couples, and families living in different NYC boroughs.",
      category: "budgeting",
      readTime: "15 min",
      date: "Mar 8, 2026",
      tags: ["budgeting", "expenses", "nyc life"],
      trending: true,
      recent: true
    },
    {
      id: 4,
      title: "Bronx vs. Queens vs. Brooklyn: 2026 Cost Comparison",
      slug: "bronx-queens-brooklyn-2026-cost-comparison",
      excerpt: "Detailed borough-by-borough cost analysis including rent, groceries, transportation, and hidden expenses you need to know.",
      category: "cost",
      readTime: "14 min",
      date: "Mar 5, 2026",
      tags: ["cost of living", "boroughs", "comparison"],
      trending: false,
      recent: true
    },
    {
      id: 5,
      title: "High-Yield Savings Accounts for NYC Residents (2026 Guide)",
      slug: "high-yield-savings-accounts-nyc-residents-2026",
      excerpt: "Best savings accounts and cash management strategies for New Yorkers looking to maximize their emergency funds.",
      category: "savings",
      readTime: "8 min",
      date: "Mar 1, 2026",
      tags: ["savings", "investing", "banking"],
      trending: false,
      recent: true
    },
    {
      id: 6,
      title: "Negotiating Rent in NYC: When and How to Ask for Lower Rent",
      slug: "negotiating-rent-nyc-how-to-ask-lower-rent",
      excerpt: "Practical strategies for rent negotiation, including timing, market research, and what to say to your landlord.",
      category: "rent",
      readTime: "11 min",
      date: "Feb 26, 2026",
      tags: ["rent", "negotiation", "saving money"],
      trending: true,
      recent: true
    },
    {
      id: 7,
      title: "NYC Grocery Costs: Trader Joe's vs. Whole Foods vs. Local Markets",
      slug: "nyc-grocery-costs-trader-joes-whole-foods-local-markets",
      excerpt: "Price comparison and shopping strategies to save $200-400 monthly on groceries across different NYC neighborhoods.",
      category: "cost",
      readTime: "9 min",
      date: "Feb 22, 2026",
      tags: ["groceries", "saving money", "cost of living"],
      trending: false,
      recent: false
    },
    {
      id: 8,
      title: "Student Loan Repayment Strategies for NYC Professionals",
      slug: "student-loan-repayment-strategies-nyc-professionals",
      excerpt: "Income-driven repayment plans, forgiveness programs, and budgeting strategies for managing student debt in high-cost NYC.",
      category: "credit",
      readTime: "13 min",
      date: "Feb 18, 2026",
      tags: ["student loans", "debt", "financial planning"],
      trending: false,
      recent: false
    },
    {
      id: 9,
      title: "Side Hustles That Actually Pay in NYC (2026 Opportunities)",
      slug: "side-hustles-that-actually-pay-nyc-2026",
      excerpt: "Realistic side income opportunities for New Yorkers, from freelance work to local gig economy jobs.",
      category: "savings",
      readTime: "10 min",
      date: "Feb 15, 2026",
      tags: ["side hustles", "extra income", "nyc jobs"],
      trending: true,
      recent: false
    }
  ];

  // ===== DOM ELEMENTS =====
  const postsGrid = document.getElementById('postsGrid');
  const trendingPosts = document.getElementById('trendingPosts');
  const recentPosts = document.getElementById('recentPosts');
  const categoryButtons = document.querySelectorAll('.category-filter button');
  const searchInput = document.getElementById('searchInput');
  const mobileMenuBtn = document.getElementById('mobileMenuBtn');
  const navMenu = document.getElementById('navMenu');
  const backToTopBtn = document.getElementById('backToTop');

  // ===== INITIALIZE PAGE =====
  document.addEventListener('DOMContentLoaded', function() {
    // Generate slugs for any posts that don't have them (for future posts)
    blogPosts.forEach(post => {
      if (!post.slug) {
        post.slug = generateSlug(post.title);
      }
    });
    
    renderAllPosts();
    renderTrendingPosts();
    renderRecentPosts();
    setupEventListeners();
    animatePostCards();
  });

  // ===== RENDER FUNCTIONS =====
  function renderAllPosts(filterCategory = 'all', searchTerm = '') {
    postsGrid.innerHTML = '';
    
    let filteredPosts = blogPosts;
    
    // Apply category filter
    if (filterCategory !== 'all') {
      filteredPosts = blogPosts.filter(post => post.category === filterCategory);
    }
    
    // Apply search filter
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      filteredPosts = filteredPosts.filter(post => 
        post.title.toLowerCase().includes(term) ||
        post.excerpt.toLowerCase().includes(term) ||
        post.tags.some(tag => tag.toLowerCase().includes(term))
      );
    }
    
    // Render posts
    filteredPosts.forEach((post, index) => {
      const postCard = document.createElement('article');
      postCard.className = 'post-card';
      postCard.style.animationDelay = `${index * 0.1}s`;
      
      postCard.innerHTML = `
        <div class="tags">
          ${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
        </div>
        <h3><a href="posts/${post.slug}.html">${post.title}</a></h3>
        <p>${post.excerpt}</p>
        <div class="meta">
          <span><i class="far fa-clock"></i> ${post.readTime} read</span>
          <span><i class="far fa-calendar"></i> ${post.date}</span>
        </div>
      `;
      
      postsGrid.appendChild(postCard);
      
      // Add animation class after a small delay
      setTimeout(() => {
        postCard.classList.add('visible');
      }, 100 + (index * 100));
    });
    
    // If no posts found
    if (filteredPosts.length === 0) {
      postsGrid.innerHTML = `
        <div class="no-results" style="grid-column:1/-1; text-align:center; padding:40px;">
          <i class="fas fa-search" style="font-size:48px; color:var(--text-light); margin-bottom:20px;"></i>
          <h3 style="color:var(--text-primary); margin-bottom:10px;">No posts found</h3>
          <p style="color:var(--text-secondary);">Try adjusting your search or filter criteria.</p>
        </div>
      `;
    }
  }

  function renderTrendingPosts() {
    const trending = blogPosts.filter(post => post.trending).slice(0, 5);
    trendingPosts.innerHTML = trending.map(post => `
      <li>
        <a href="posts/${post.slug}.html">
          <i class="fas fa-chevron-right"></i>
          ${post.title}
        </a>
      </li>
    `).join('');
  }

  function renderRecentPosts() {
    const recent = blogPosts.filter(post => post.recent).slice(0, 5);
    recentPosts.innerHTML = recent.map(post => `
      <li>
        <a href="posts/${post.slug}.html">
          <i class="fas fa-chevron-right"></i>
          ${post.title}
        </a>
      </li>
    `).join('');
  }

  // ===== EVENT HANDLERS =====
  function setupEventListeners() {
    // Category filter buttons
    categoryButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Remove active class from all buttons
        categoryButtons.forEach(btn => btn.classList.remove('active'));
        // Add active class to clicked button
        this.classList.add('active');
        
        const category = this.getAttribute('data-category');
        renderAllPosts(category, searchInput.value);
      });
    });
    
    // Search input
    searchInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
    
    // Mobile menu toggle
    mobileMenuBtn.addEventListener('click', function() {
      navMenu.classList.toggle('show');
      mobileMenuBtn.innerHTML = navMenu.classList.contains('show') 
        ? '<i class="fas fa-times"></i>' 
        : '<i class="fas fa-bars"></i>';
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
      if (!navMenu.contains(e.target) && !mobileMenuBtn.contains(e.target) && navMenu.classList.contains('show')) {
        navMenu.classList.remove('show');
        mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
      }
    });
    
    // Back to top button
    window.addEventListener('scroll', function() {
      if (window.pageYOffset > 300) {
        backToTopBtn.classList.add('show');
      } else {
        backToTopBtn.classList.remove('show');
      }
    });
    
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    // Sidebar category links
    document.querySelectorAll('.sidebar-section ul li a[data-cat]').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const category = this.getAttribute('data-cat');
        
        // Update active button in filter section
        categoryButtons.forEach(btn => {
          btn.classList.remove('active');
          if (btn.getAttribute('data-category') === category) {
            btn.classList.add('active');
          }
        });
        
        // Scroll to blog section and filter
        document.getElementById('blog').scrollIntoView({ behavior: 'smooth' });
        renderAllPosts(category);
      });
    });
  }

  // ===== SEARCH FUNCTION =====
  function performSearch() {
    const searchTerm = searchInput.value.trim();
    const activeCategory = document.querySelector('.category-filter button.active').getAttribute('data-category');
    renderAllPosts(activeCategory, searchTerm);
    
    // Scroll to results if not visible
    if (window.pageYOffset > postsGrid.offsetTop) {
      postsGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  // ===== NEWSLETTER SUBSCRIPTION =====
  function subscribeNewsletter() {
    const emailInput = document.getElementById('newsletterEmail');
    const email = emailInput.value.trim();
    
    if (!email) {
      alert('Please enter your email address.');
      emailInput.focus();
      return;
    }
    
    if (!validateEmail(email)) {
      alert('Please enter a valid email address.');
      emailInput.focus();
      return;
    }
    
    // Simulate subscription process
    emailInput.value = '';
    
    // Show success message
    alert('Thank you for subscribing! Check your email for the NYC Budget Toolkit download link.');
    
    // In a real implementation, you would send this to a backend
    console.log('Newsletter subscription:', email);
  }

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // ===== ANIMATION FUNCTIONS =====
  function animatePostCards() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });
    
    document.querySelectorAll('.post-card').forEach(card => {
      observer.observe(card);
    });
  }

  // ===== ADDITIONAL FEATURES =====
  // Update copyright year
  document.addEventListener('DOMContentLoaded', function() {
    const copyrightElement = document.querySelector('.copyright p');
    if (copyrightElement) {
      copyrightElement.innerHTML = copyrightElement.innerHTML.replace('2026', new Date().getFullYear());
    }
  });

  // Handle newsletter form submission on Enter key
  document.getElementById('newsletterEmail').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      subscribeNewsletter();
    }
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      
      if (href === '#' || href === '#!') return;
      
      const target = document.querySelector(href);
      if (target) {
        e.preventDefault();
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
        
        // Close mobile menu if open
        if (navMenu.classList.contains('show')) {
          navMenu.classList.remove('show');
          mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
        }
      }
    });
  });
</script>
